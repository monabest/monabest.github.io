<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">



<title>
  
    Reading -Effective Java
  
</title>

<meta name="description" content="reading notes of Effective Java">
<meta property="og:type" content="article">
<meta property="og:title" content="Reading -Effective Java">
<meta property="og:url" content="http://monabest.github.io/2017/02/05/Reading-Effective-Java/index.html">
<meta property="og:site_name" content="MonaBest-Blogggyyy">
<meta property="og:description" content="reading notes of Effective Java">
<meta property="og:updated_time" content="2017-03-03T20:20:08.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Reading -Effective Java">
<meta name="twitter:description" content="reading notes of Effective Java">


  <link rel="alternative" href="/atom.xml" title="MonaBest-Blogggyyy" type="application/atom+xml">



  <link rel="icon" href="/favicon.png">


<link rel="stylesheet" href="/styles/main.css">






</head>
<body
  
    class="monochrome"
  
  >
  <div class="mobile-header">
  <button class="sidebar-toggle" type="button">
    <span class="icon-bar"></span>
    <span class="icon-bar"></span>
    <span class="icon-bar"></span>
  </button>
  <a class="title" href="/">MonaBest-Blogggyyy</a>
</div>

  <div class="main-container">
    <div class="sidebar">
  <div class="header">
    <h1 class="title"><a href="/">MonaBest-Blogggyyy</a></h1>
    
    <div class="info">
      <div class="content">
        
        
          <div class="author">Mona Qiu</div>
        
      </div>
      
        <div class="avatar">
          
            <a href="monabest.git.io"><img src="http://scontent.cdninstagram.com/t51.2885-15/s480x480/e35/11351794_1500041536990504_88089302_n.jpg?ig_cache_key=MTExNzUzMjQyNDAxMDY4MDcyNg%3D%3D.2"></a>
          
        </div>
      
    </div>
  </div>
  <div class="body">
    
      
        <ul class="nav">
          
            
              <li class="category-list-container">
                <a href="javascript:;">Category</a>
                <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/programming/">programming</a><span class="category-list-count">1</span></li></ul>
              </li>
            
          
            
              <li class="tag-list-container">
                <a href="javascript:;">Tag</a>
                <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Java-Programming/">Java Programming</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/System-Design/">System Design</a><span class="tag-list-count">1</span></li></ul>
              </li>
            
          
        </ul>
      
        <ul class="nav">
          
            
              <li>
                <a href="/" title="Homepage">Homepage</a>
              </li>
            
          
            
              <li>
                <a href="/archives" title="By Year">By Year</a>
              </li>
            
          
        </ul>
      
        <ul class="nav">
          
            
              <li>
                <a href="https://github.com/monabest" title="Github" target="_blank" rel="external">Github</a>
              </li>
            
          
            
              <li>
                <a href="https://www.linkedin.com/in/monaqiu/" title="Linkedin" target="_blank" rel="external">Linkedin</a>
              </li>
            
          
        </ul>
      
    
  </div>
</div>

    <div class="main-content">
      
        <div style="max-width: 2300px">
      
          <article id="post-Reading-Effective-Java" class="article article-type-post">
  
    <h1 class="article-header">
      Reading -Effective Java
    </h1>
  
  

  <div class="article-info">
    <span class="article-date">
  2017-02-05
</span>

    

    
	<span class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Java-Programming/">Java Programming</a></li></ul>
	</span>


  </div>
  <div class="article-entry">
    <p>reading notes of Effective Java<br><a id="more"></a></p>
<h1 id="Effective-Java"><a href="#Effective-Java" class="headerlink" title="Effective Java"></a>Effective Java</h1><h2 id="Chapter-1"><a href="#Chapter-1" class="headerlink" title="Chapter 1"></a>Chapter 1</h2><p>make effective use of  <code>java.util, java.util.concurrent, java.io</code><br>module refers to any reusable software component</p>
<blockquote>
<ul>
<li>Interfaces (including annota- tions), classes (including enums), array are reference types</li>
<li>Primitives are not objects</li>
<li>A method’s signature: 1. its name 2. the types of its formal parameters</li>
<li>Signature does not include the method’s return type.</li>
</ul>
</blockquote>
<p>This book uses  <code>package-private</code> instead of the term  <code>default</code> access.<br>The term <code>exported API</code>, or <code>API</code>, refers to the classes, interfaces, constructors, members, and serialized forms by which a programmer accesses a class, interface, or package.<br>API short for <em>application programming interface</em>.<br>A class whose implementation uses an API is a client of the API.<br>Classes, interfaces, constructors, members, and serialized forms are collec- tively known as API elements.</p>
<h2 id="Chapter-2"><a href="#Chapter-2" class="headerlink" title="Chapter 2"></a>Chapter 2</h2><h3 id="Creating-and-Destroying-Objects"><a href="#Creating-and-Destroying-Objects" class="headerlink" title="Creating and Destroying Objects"></a>Creating and Destroying Objects</h3><h4 id="Item-1-consider-static-factory-methods-instead-of-constructors"><a href="#Item-1-consider-static-factory-methods-instead-of-constructors" class="headerlink" title="Item 1: consider static factory methods instead of constructors"></a>Item 1: consider static factory methods instead of constructors</h4><p>A normal way for a class to provide an instance of itself is to provide a public constructor.<br>Another technique is that a class can provide a <code>public static factory method</code>, which is simply a static method that returns an instance of the class.<br>Advantages:</p>
<blockquote>
<ul>
<li>name easier to read: e.g.BigInteger(int, int, Random), returns a BigInteger that is probably prime, would have been better expressed as a static factory method named BigIn- teger.probablePrime.The Boolean.valueOf(boolean) method illus- trates this technique: it never creates an object. </li>
<li>In cases where a class seems to require multiple constructors with the same signature, replace the constructors with static factory methods and carefully chosen names to highlight their differences.</li>
<li>Static factory methods is unlike constructors. They are not required to create a new object each time they’re invoked. The Boolean.valueOf(boolean) method illustrates this technique: it never creates an object</li>
<li>unlike constructors, they can return an object of any subtype of their return type</li>
<li>static factory methods reduce the verbosity of creating parameterized type instances. e.g. Map<string, list<string="">&gt; m = HashMap.newInstance();</string,></li>
</ul>
</blockquote>
<p>Distanvages:</p>
<blockquote>
<ul>
<li>classes without public or protected constructors cannot be subclassed.</li>
<li>they are not readily distinguishable from other static methods. </li>
</ul>
</blockquote>
<p>Three essential components of a service provider framework:</p>
<ol>
<li>a service interface: provides implement</li>
<li>a provider registration API: systems uses to register implements.</li>
<li>service access API: clients use to obtain an instance of the service.</li>
<li>serice provider interface: provdes implement to create instances of their service implementation.<br>StackOverFlow example:<br>The static factory method pattern is a way to encapsulate object creation. Without a factory method, you would simply call the class’s constructor directly: <code>Foo x = new Foo()</code>. With this pattern, you would instead call the factory method: <code>Foo x = Foo.create()</code> The constructors are marked private, so they cannot be called except from inside the class, and the factory method is marked as static so that it can be called without first having an object.</li>
</ol>
<h4 id="Item-2-consider-a-builder-when-faced-with-many-constructor-parameters"><a href="#Item-2-consider-a-builder-when-faced-with-many-constructor-parameters" class="headerlink" title="Item 2: consider a builder when faced with many constructor parameters"></a>Item 2: consider a builder when faced with many constructor parameters</h4><p>static factories and constructor have limitation: do not handle well with large numbers of optional parameters.<br>Traditionally, use <code>telescoping constructor pattern</code>: You provide a constructor with only required params, another with a single optional param, a thrid with 2 optional params and so on. e.g<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//doesn't scale well, only part of the code.</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="title">NutritionFacts</span><span class="params">(<span class="keyword">int</span> servingSize, <span class="keyword">int</span> servings)</span> </span>&#123;</div><div class="line">    <span class="keyword">this</span>(servingSize, servings, <span class="number">0</span>);</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="title">NutritionFacts</span><span class="params">(<span class="keyword">int</span> servingSize, <span class="keyword">int</span> servings,</span></span></div><div class="line">        <span class="keyword">int</span> calories) &#123;</div><div class="line">    <span class="keyword">this</span>(servingSize, servings, calories, <span class="number">0</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>A second alternative when you are faced with many constructor parameters is the <code>JavaBeans pattern</code>: call a parameterless constructor to create the object ad call setters. disadvantages: 1. may be in an inconsistent state partway through its construction. 2. precludes the possibility of making a class immutable<br>A third alternative: <code>Builder Pattern</code> combines the safety of the telescoping constructor pattern with the readability of the JavaBeans pattern.<br>Step:</p>
<blockquote>
<ul>
<li>client calls a constructor (or static factory) with all required parameters and gets a builder object.</li>
<li>client calls setter-like methods on the builder object to set each optional parameter of itereset.</li>
<li>client calls a parameterless build method to generate the immutable object.</li>
<li>builder is a static member class of the class it builds.</li>
</ul>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// Builder Pattern</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NutritionFacts</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> servingSize;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> servings;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> calories;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> fat;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> sodium;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> carbohydrate;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Builder</span> </span>&#123;</div><div class="line">        <span class="comment">// Required parameters</span></div><div class="line">        <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> servingSize;</div><div class="line">        <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> servings;</div><div class="line">        <span class="comment">// Optional parameters </span></div><div class="line">        <span class="keyword">private</span> <span class="keyword">int</span> calories      = <span class="number">0</span>;</div><div class="line">        <span class="keyword">private</span> <span class="keyword">int</span> fat           = <span class="number">0</span>;</div><div class="line">        <span class="keyword">private</span> <span class="keyword">int</span> carbohydrate  = <span class="number">0</span>;</div><div class="line">        <span class="keyword">private</span> <span class="keyword">int</span> sodium        = <span class="number">0</span>;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Builder</span><span class="params">(<span class="keyword">int</span> servingSize, <span class="keyword">int</span> servings)</span> </span>&#123;</div><div class="line">            <span class="keyword">this</span>.servingSize = servingSize;</div><div class="line">            <span class="keyword">this</span>.servings    = servings;</div><div class="line">    &#125;</div><div class="line">        <span class="function"><span class="keyword">public</span> Builder <span class="title">calories</span><span class="params">(<span class="keyword">int</span> val)</span></span></div><div class="line">            &#123; calories = val;      <span class="keyword">return</span> <span class="keyword">this</span>; &#125;</div><div class="line">        <span class="function"><span class="keyword">public</span> Builder <span class="title">fat</span><span class="params">(<span class="keyword">int</span> val)</span></span></div><div class="line">            &#123; fat = val;           <span class="keyword">return</span> <span class="keyword">this</span>; &#125;</div><div class="line">        <span class="function"><span class="keyword">public</span> Builder <span class="title">carbohydrate</span><span class="params">(<span class="keyword">int</span> val)</span></span></div><div class="line">            &#123; carbohydrate = val;  <span class="keyword">return</span> <span class="keyword">this</span>; &#125;</div><div class="line">        <span class="function"><span class="keyword">public</span> Builder <span class="title">sodium</span><span class="params">(<span class="keyword">int</span> val)</span></span></div><div class="line">            &#123; sodium = val;        <span class="keyword">return</span> <span class="keyword">this</span>; &#125;</div><div class="line">        <span class="function"><span class="keyword">public</span> NutritionFacts <span class="title">build</span><span class="params">()</span> </span>&#123;</div><div class="line">            <span class="keyword">return</span> <span class="keyword">new</span> NutritionFacts(<span class="keyword">this</span>);</div><div class="line">        &#125; </div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="title">NutritionFacts</span><span class="params">(Builder builder)</span> </span>&#123;</div><div class="line">        servingSize  = builder.servingSize;</div><div class="line">        servings = buider.servings;</div><div class="line">        calories = builder.calories;</div><div class="line">        fat = builder.fat;</div><div class="line">        sodium = builder.sodium;</div><div class="line">        carbohydrate = builder.carbohydrate;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p> NutritionFacts is immutable, and that all parameter default values are in a single location. The builder’s setter methods return the builder itself so that invocations can be chained. Here’s how the client code looks:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">NutritionFacts cocaCola = <span class="keyword">new</span> NutritionFacts.Builder(<span class="number">240</span>, <span class="number">8</span>).calories(<span class="number">100</span>).sodium(<span class="number">35</span>).carbohydrate(<span class="number">27</span>).build();</div></pre></td></tr></table></figure></p>
<h4 id="Item3-Enforce-the-singleton-property-with-a-private-constructor-or-an-enum-type"><a href="#Item3-Enforce-the-singleton-property-with-a-private-constructor-or-an-enum-type" class="headerlink" title="Item3: Enforce the singleton property with a private constructor or an enum type"></a>Item3: Enforce the singleton property with a private constructor or an enum type</h4><p>singleton class implements:</p>
<ol>
<li><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// Singleton with public final field</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Elvis</span> </span>&#123;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Elvis INSTANCE = <span class="keyword">new</span> Elvis();</div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Elvis</span><span class="params">()</span> </span>&#123; ... &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">leaveTheBuilding</span><span class="params">()</span> </span>&#123; ... &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ol>
<p>2.<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// Singleton with static factory</span></div><div class="line">  <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Elvis</span> </span>&#123;</div><div class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Elvis INSTANCE = <span class="keyword">new</span> Elvis();          <span class="function"><span class="keyword">private</span> <span class="title">Elvis</span><span class="params">()</span> </span>&#123; ... &#125;</div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Elvis <span class="title">getInstance</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> INSTANCE; &#125;</div><div class="line">     <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">leaveTheBuilding</span><span class="params">()</span> </span>&#123; ... &#125;</div><div class="line"> &#125;</div></pre></td></tr></table></figure></p>
<ol>
<li>best, provides the serializatin machinery for free.<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// Enum singleton - the preferred approach</span></div><div class="line"><span class="keyword">public</span> <span class="keyword">enum</span> Elvis &#123;</div><div class="line">    INSTANCE;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">leaveTheBuilding</span><span class="params">()</span> </span>&#123; ... &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ol>
<h4 id="Item4-Enforce-noninstantialibity-with-a-private-constructor"><a href="#Item4-Enforce-noninstantialibity-with-a-private-constructor" class="headerlink" title="Item4: Enforce noninstantialibity with a private constructor"></a>Item4: Enforce noninstantialibity with a private constructor</h4><p>A default construc- tor is generated only if a class contains no explicit constructors, so a class can be made noninstantiable by including a private constructor:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// Noninstantiable utility class</span></div><div class="line"> <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UtilityClass</span> </span>&#123;</div><div class="line">     <span class="comment">// Suppress default constructor for noninstantiability</span></div><div class="line">     <span class="function"><span class="keyword">private</span> <span class="title">UtilityClass</span><span class="params">()</span> </span>&#123;</div><div class="line">         <span class="keyword">throw</span> <span class="keyword">new</span> AssertionError();</div><div class="line">  &#125;</div><div class="line">     ...  <span class="comment">// Remainder omitted</span></div><div class="line"> &#125;</div></pre></td></tr></table></figure></p>
<p>It guarantees that the class will never be instantiated under any circumstances. This idiom also prevents the class from being subclassed. All constructors must invoke a superclass constructor, explicitly or implicitly, and a subclass would have no accessible superclass constructor to invoke.</p>
<h4 id="Item5-Avoid-creating-unnecessary-objects"><a href="#Item5-Avoid-creating-unnecessary-objects" class="headerlink" title="Item5: Avoid creating unnecessary objects"></a>Item5: Avoid creating unnecessary objects</h4><p>String s = new String(“stringette”); // DON’T DO THIS!<br>“stringette” is itself a string instance. If this use occurs in a loop or in a frequently invoked method, many string instances will be created needlessly.So just simply<br>String s = “stringette”;<br>This uses a single string instance rather than creating a new one each time.</p>
<h4 id="Item6-Eliminate-obsolete-object-references"><a href="#Item6-Eliminate-obsolete-object-references" class="headerlink" title="Item6: Eliminate obsolete object references"></a>Item6: Eliminate obsolete object references</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">   <span class="comment">// Can you spot the "memory leak"?</span></div><div class="line">   <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Stack</span> </span>&#123;</div><div class="line">       <span class="keyword">private</span> Object[] elements;</div><div class="line">       <span class="keyword">private</span> <span class="keyword">int</span> size = <span class="number">0</span>;</div><div class="line">       <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> DEFAULT_INITIAL_CAPACITY = <span class="number">16</span>;</div><div class="line">       <span class="function"><span class="keyword">public</span> <span class="title">Stack</span><span class="params">()</span> </span>&#123;</div><div class="line">           elements = <span class="keyword">new</span> Object[DEFAULT_INITIAL_CAPACITY];</div><div class="line">&#125;</div><div class="line">       <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">push</span><span class="params">(Object e)</span> </span>&#123;</div><div class="line">           ensureCapacity();</div><div class="line">           elements[size++] = e;</div><div class="line">&#125;</div><div class="line">       <span class="function"><span class="keyword">public</span> Object <span class="title">pop</span><span class="params">()</span> </span>&#123;</div><div class="line">           <span class="keyword">if</span> (size == <span class="number">0</span>)</div><div class="line">               <span class="keyword">throw</span> <span class="keyword">new</span> EmptyStackException();</div><div class="line">           <span class="keyword">return</span> elements[--size];</div><div class="line">&#125;</div><div class="line">       <span class="comment">/**</span></div><div class="line">        * Ensure space for at least one more element, roughly</div><div class="line">        * doubling the capacity each time the array needs to grow.</div><div class="line">        */</div><div class="line">       <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">ensureCapacity</span><span class="params">()</span> </span>&#123;</div><div class="line">           <span class="keyword">if</span> (elements.length == size)</div><div class="line">               elements = Arrays.copyOf(elements, <span class="number">2</span> * size + <span class="number">1</span>);</div><div class="line">&#125; </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>It will have obsolete reference. should be modified as<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> Object <span class="title">pop</span><span class="params">()</span> </span>&#123;</div><div class="line">       <span class="keyword">if</span> (size == <span class="number">0</span>)</div><div class="line"><span class="keyword">throw</span> <span class="keyword">new</span> EmptyStackException();</div><div class="line">Object result = elements[--size];</div><div class="line">elements[size] = <span class="keyword">null</span>; <span class="comment">// Eliminate obsolete reference return result;</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h4 id="Item7-Avoid-finalizers"><a href="#Item7-Avoid-finalizers" class="headerlink" title="Item7: Avoid finalizers"></a>Item7: Avoid finalizers</h4><p>never do anything time-critical in a finalizer.For example, it is a grave error to depend on a finalizer to close files, because open file descriptors are a limited resource. If many files are left open because the JVM is tardy in execut- ing finalizers, a program may fail because it can no longer open files.<br>never depend on a finalizer to update critical persistent state. For example, depending on a finalizer to release a persistent lock on a shared resource such as a database is a good way to bring your entire distributed system to a grinding halt.<br>Explicit termination methods are typically used in combination with the try-finally construct to ensure termination. Invoking the explicit termination method inside the finally clause ensures that it will get executed even if an exception is thrown while the object is being used<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// try-finally block guarantees execution of termination method</span></div><div class="line"> Foo foo = <span class="keyword">new</span> Foo(...);</div><div class="line"> <span class="keyword">try</span> &#123;</div><div class="line">     <span class="comment">// Do what must be done with foo</span></div><div class="line">     ...</div><div class="line"> &#125; <span class="keyword">finally</span> &#123;</div><div class="line">     foo.terminate();  <span class="comment">// Explicit termination method</span></div><div class="line"> &#125;</div></pre></td></tr></table></figure></p>
<h2 id="Chapter-3-Methods-Common-to-All-Objects"><a href="#Chapter-3-Methods-Common-to-All-Objects" class="headerlink" title="Chapter 3 - Methods Common to All Objects"></a>Chapter 3 - Methods Common to All Objects</h2><p>####Item 8: Obey the general contract when overriding equals<br>when is it appropriate to override Object.equals?<br>When a class has a notion of logical equality that differs from mere object identity, and a superclass has not already overridden equals to implement the desired behavior.<br>One kind of value class that does not require the equals method to be overridden is a class that uses instance control to ensure that at most one object exists with each value. e.g. Enum types  For these classes, logical equality is the same as object identity, so Object’s equals method functions as a logical equals method.<br>For any non-nullreference </p>
<blockquote>
<ul>
<li>reflexive: x.equals(x) ==true.</li>
<li>symmetric: x.equals(y) == true and y.equals(z)  == true, then x.equals(z) must be true</li>
<li>consistent: x.equals(y) consistently return true or flase</li>
<li>x.equals(null) must return false</li>
</ul>
</blockquote>
<p>There is no way to extend an instantiable class and add a value component while preserving the equals contract, unless you are willing to forgo the benefits of object-oriented abstraction.<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">   <span class="comment">// Adds a value component without violating the equals contract</span></div><div class="line">   <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ColorPoint</span> </span>&#123;</div><div class="line">      <span class="keyword">private</span> <span class="keyword">final</span> Point point;</div><div class="line">      <span class="keyword">private</span> <span class="keyword">final</span> Color color;</div><div class="line">      <span class="function"><span class="keyword">public</span> <span class="title">ColorPoint</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y, Color color)</span> </span>&#123;</div><div class="line">         <span class="keyword">if</span> (color == <span class="keyword">null</span>)</div><div class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException();</div><div class="line">         point = <span class="keyword">new</span> Point(x, y);</div><div class="line">         <span class="keyword">this</span>.color = color;</div><div class="line">&#125;</div><div class="line">      <span class="comment">/**</span></div><div class="line">       * Returns the point-view of this color point.</div><div class="line">       */</div><div class="line">    <span class="function"><span class="keyword">public</span> Point <span class="title">asPoint</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> point;</div><div class="line">&#125;</div><div class="line">      <span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object o)</span> </span>&#123;</div><div class="line">         <span class="keyword">if</span> (!(o <span class="keyword">instanceof</span> ColorPoint))</div><div class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">         ColorPoint cp = (ColorPoint) o;</div><div class="line">         <span class="keyword">return</span> cp.point.equals(point) &amp;&amp; cp.color.equals(color);</div><div class="line">&#125;</div><div class="line">      ...  <span class="comment">// Remainder omitted</span></div><div class="line">   &#125;</div></pre></td></tr></table></figure></p>
<p>don’t have to do a separate check for null such as<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">  <span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object o)</span> </span>&#123;</div><div class="line">              <span class="keyword">if</span> (o == <span class="keyword">null</span>)</div><div class="line">                  <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">              ...</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>Because: the instanceof operator is specified to return false if its first operand is null, regardless of what type appears in the second operand. Therefore the type check will return false if null is passed in, so you don’t need a separate null check.<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object o)</span> </span>&#123;</div><div class="line">             <span class="keyword">if</span> (!(o <span class="keyword">instanceof</span> MyType))</div><div class="line">                 <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">             MyType mt = (MyType) o;</div><div class="line">             ...</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>Putting it all together:</p>
<blockquote>
<ul>
<li>1.Use the == operator to check if the argument is a reference to this object.</li>
<li>2.Use the instanceof operator to check if the argument has the correct type.</li>
<li><ol>
<li>Cast the argument to the correct type. This cast is preceded by an instanceof test.</li>
</ol>
</li>
<li><ol>
<li>For each “significant” field in the class, check if that field of the argument matches the corresponding field of this object.</li>
</ol>
</li>
</ul>
</blockquote>
<p>For primitive fields whose type is not float or double, use the == operator for comparisons;<br>for object reference fields, invoke the equals method recursively;<br>for float fields, use the Float.compare method;<br>and for double fields, use Double.compare<br>Some object reference fields may legitimately contain null. To avoid the pos- sibility of a NullPointerException, use this idiom to compare such fields:<br>(field == null ? o.field == null : field.equals(o.field)) This alternative may be faster if field and o.field are often identical:<br>(field == o.field || (field != null &amp;&amp; field.equals(o.field)))<br>Don’t substitute another type for Object in the equals declaration.<br>Consistent use of the @Override annotation</p>
<h3 id="Item-9-Always-override-hashCode-when-you-override-equals"><a href="#Item-9-Always-override-hashCode-when-you-override-equals" class="headerlink" title="#Item 9: Always override hashCode when you override equals"></a>#Item 9: Always override hashCode when you override equals</h3><p>You must override hashCode in every class that overrides equals. Failure to do so will result in a violation of the general contract for Object.hashCode, which will prevent your class from functioning properly in conjunction with all hash-based collections, including HashMap, HashSet, and Hashtable.<br>result = 31 <em> result + c;<br>A nonzero initial value is used in step 1 so the hash value will be affected by initial fields whose hash value<br>A nice property of 31 is that the multiplication can be replaced by a shift and a subtraction for better performance: 31 </em> i == (i &lt;&lt; 5) - i. Modern VMs do this sort of optimization automatically.<br>example:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">       <span class="meta">@Override</span> </div><div class="line">       <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">hashCode</span><span class="params">()</span> </span>&#123;</div><div class="line">           <span class="keyword">int</span> result = <span class="number">17</span>;</div><div class="line">           result = <span class="number">31</span> * result + areaCode;</div><div class="line">           result = <span class="number">31</span> * result + prefix;</div><div class="line">           result = <span class="number">31</span> * result + lineNumber;</div><div class="line">           <span class="keyword">return</span> result;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h4 id="Item10-Always-override-toString"><a href="#Item10-Always-override-toString" class="headerlink" title="Item10: Always override toString"></a>Item10: Always override toString</h4><p>While it isn’t as important as obeying the equals and hashCode contracts (Item 8, Item 9), providing a good toString implementation makes your class much more pleasant to use.</p>
<h4 id="Item11-Override-clone-judiciously"><a href="#Item11-Override-clone-judiciously" class="headerlink" title="Item11: Override clone judiciously"></a>Item11: Override clone judiciously</h4><p> x.clone().equals(x)</p>
<p>the clone method functions as another constructor; you must ensure that it does no harm to the original object and that it prop- erly establishes invariants on the clone.<br>reference issues in below if use super.clone()<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Stack</span> </span>&#123;</div><div class="line">       <span class="keyword">private</span> Object[] elements;</div><div class="line">       <span class="keyword">private</span> <span class="keyword">int</span> size = <span class="number">0</span>;</div><div class="line">       <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> DEFAULT_INITIAL_CAPACITY = <span class="number">16</span>;</div><div class="line">       <span class="function"><span class="keyword">public</span> <span class="title">Stack</span><span class="params">()</span> </span>&#123;</div><div class="line">           <span class="keyword">this</span>.elements = <span class="keyword">new</span> Object[DEFAULT_INITIAL_CAPACITY];</div><div class="line">&#125;</div><div class="line">       <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">push</span><span class="params">(Object e)</span> </span>&#123;</div><div class="line">           ensureCapacity();</div><div class="line">           elements[size++] = e;</div><div class="line">&#125;</div><div class="line">       <span class="function"><span class="keyword">public</span> Object <span class="title">pop</span><span class="params">()</span> </span>&#123;</div><div class="line">           <span class="keyword">if</span> (size == <span class="number">0</span>)</div><div class="line">               <span class="keyword">throw</span> <span class="keyword">new</span> EmptyStackException();</div><div class="line">           Object result = elements[--size];</div><div class="line">           elements[size] = <span class="keyword">null</span>; <span class="comment">// Eliminate obsolete reference</span></div><div class="line">           <span class="keyword">return</span> result;</div><div class="line">&#125;</div><div class="line">       <span class="comment">// Ensure space for at least one more element.</span></div><div class="line">       <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">ensureCapacity</span><span class="params">()</span> </span>&#123;</div><div class="line">           <span class="keyword">if</span> (elements.length == size)</div><div class="line">               elements = Arrays.copyOf(elements, <span class="number">2</span> * size + <span class="number">1</span>);</div><div class="line">    &#125; </div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>Should use<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"> <span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> Stack <span class="title">clone</span><span class="params">()</span> </span>&#123;</div><div class="line">       <span class="keyword">try</span> &#123;</div><div class="line">           Stack result = (Stack) <span class="keyword">super</span>.clone();</div><div class="line">           result.elements = elements.clone();</div><div class="line">           <span class="keyword">return</span> result;</div><div class="line">       &#125; <span class="keyword">catch</span> (CloneNotSupportedException e) &#123;</div><div class="line">           <span class="keyword">throw</span> <span class="keyword">new</span> AssertionError();</div><div class="line">    &#125; </div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>the clone architecture is incompatible with normal use of final fields referring to mutable objects<br>for hashtable<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HashTable</span> <span class="keyword">implements</span> <span class="title">Cloneable</span> </span>&#123;</div><div class="line">       <span class="keyword">private</span> Entry[] buckets = ...;</div><div class="line">       <span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Entry</span> </span>&#123;</div><div class="line">           <span class="keyword">final</span> Object key;</div><div class="line">           Object value;</div><div class="line">           Entry  next;</div><div class="line">           Entry(Object key, Object value, Entry next) &#123;</div><div class="line">               <span class="keyword">this</span>.key   = key;</div><div class="line">               <span class="keyword">this</span>.value = value;</div><div class="line">               <span class="keyword">this</span>.next  = next;</div><div class="line">&#125;</div><div class="line"><span class="comment">// Recursively copy the linked list headed by this Entry</span></div><div class="line">           <span class="function">Entry <span class="title">deepCopy</span><span class="params">()</span> </span>&#123;</div><div class="line">               <span class="keyword">return</span> <span class="keyword">new</span> Entry(key, value,</div><div class="line">                   next == <span class="keyword">null</span> ? <span class="keyword">null</span> : next.deepCopy());</div><div class="line">    &#125; </div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>If the list is long, this could easily cause a stack overflow. To prevent this from happening, you can replace the recursion in deepCopy with iteration:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// Iteratively copy the linked list headed by this Entry</span></div><div class="line">   <span class="function">Entry <span class="title">deepCopy</span><span class="params">()</span> </span>&#123;</div><div class="line">      Entry result = <span class="keyword">new</span> Entry(key, value, next);</div><div class="line">      <span class="keyword">for</span> (Entry p = result; p.next != <span class="keyword">null</span>; p = p.next)</div><div class="line">      p.next = <span class="keyword">new</span> Entry(p.next.key, p.next.value,    p.next.next);</div><div class="line">      <span class="keyword">return</span> result;</div><div class="line">   &#125;</div></pre></td></tr></table></figure></p>
<p>Furthermore, a copy constructor or factory can take an argument whose type is an interface implemented by the class. For example, by convention all general- purpose collection implementations provide a constructor whose argument is of type Collection or Map. Interface-based copy constructors and factories, more properly known as <code>conversion constructors</code> and <code>conversion factories</code>, allow the client to choose the implementation type of the copy rather than forcing the client to accept the implementation type of the original. Suppose you have a HashSet s, and you want to copy it as a TreeSet. The clone method can’t offer this function- ality, but it’s easy with a conversion constructor: new TreeSet(s).</p>
<h4 id="Item12-ConsiderimplementingComparable"><a href="#Item12-ConsiderimplementingComparable" class="headerlink" title="Item12: ConsiderimplementingComparable"></a>Item12: ConsiderimplementingComparable</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compareTo</span><span class="params">(PhoneNumber pn)</span> </span>&#123;</div><div class="line">    <span class="comment">// Compare area codes</span></div><div class="line">    <span class="keyword">int</span> areaCodeDiff = areaCode - pn.areaCode;</div><div class="line">    <span class="keyword">if</span> (areaCodeDiff != <span class="number">0</span>)</div><div class="line">        <span class="keyword">return</span> areaCodeDiff;</div><div class="line">    <span class="comment">// Area codes are equal, compare prefixes</span></div><div class="line">    <span class="keyword">int</span> prefixDiff = prefix - pn.prefix;</div><div class="line">    <span class="keyword">if</span> (prefixDiff != <span class="number">0</span>)</div><div class="line">        <span class="keyword">return</span> prefixDiff;</div><div class="line">    <span class="comment">// Area codes and prefixes are equal, compare line numbers</span></div><div class="line">    <span class="keyword">return</span> lineNumber - pn.lineNumber;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="Chapter-4"><a href="#Chapter-4" class="headerlink" title="Chapter 4 -"></a>Chapter 4 -</h2>
  </div>
  <footer class="article-footer">
    
  <div class="cc">
    <a href="http://creativecommons.org/licenses/by-sa/4.0/deed.E" target="_blank" title="Attribution-ShareAlike">
      <img src="/images/cc/cc.png">
      
          <img src="/images/cc/by.png">
        
          <img src="/images/cc/sa.png">
      
      <span>
        This work is licensed under a Creative Commons Attribution-ShareAlike 4.0 International License.
      </span>
    </a>
  </div>


    

  </footer>
</article>







          <div class="main-footer">
  
    © 2017 MonaBest-Blogggyyy - Powered by <a href="http://hexo.io" target="_blank">Hexo</a> - Theme <a href="https://github.com/denjones/hexo-theme-chan" target="_blank">Chan</a>
  
</div>

      
        </div>
      
    </div>
  </div>
  <script src="http://apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script>

  <link rel="stylesheet" href="/PhotoSwipe/photoswipe.css">
  <link rel="stylesheet" href="/PhotoSwipe/default-skin/default-skin.css">

  <!-- Root element of PhotoSwipe. Must have class pswp. -->
  <div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe.
             It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

      <!-- Container that holds slides.
                PhotoSwipe keeps only 3 of them in the DOM to save memory.
                Don't modify these 3 pswp__item elements, data is added later on. -->
      <div class="pswp__container">
        <div class="pswp__item"></div>
        <div class="pswp__item"></div>
        <div class="pswp__item"></div>
      </div>

      <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
      <div class="pswp__ui pswp__ui--hidden">

        <div class="pswp__top-bar">

          <!--  Controls are self-explanatory. Order can be changed. -->

          <div class="pswp__counter"></div>

          <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

          <button class="pswp__button pswp__button--share" title="Share"></button>

          <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

          <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

          <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
          <!-- element will get class pswp__preloader--active when preloader is running -->
          <div class="pswp__preloader">
            <div class="pswp__preloader__icn">
              <div class="pswp__preloader__cut">
                <div class="pswp__preloader__donut"></div>
              </div>
            </div>
          </div>
        </div>

        <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
          <div class="pswp__share-tooltip"></div>
        </div>

        <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>

        <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button>

        <div class="pswp__caption">
          <div class="pswp__caption__center"></div>
        </div>
      </div>
    </div>
  </div>

  <script src="/PhotoSwipe/photoswipe.js"></script>
  <script src="/PhotoSwipe/photoswipe-ui-default.js"></script>


<script src="/scripts/main.js"></script>

</body>
</html>
